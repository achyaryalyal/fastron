# the zone that limit max 5 requests/sec from 1 single IP address and hold up to 10 MB of data
limit_req_zone $binary_remote_addr zone=dev:10m rate=5r/s;

server {
    listen 80;
    root /usr/share/fastron/rainloop;
    index index.php index.html index.htm;
    charset utf-8;
    server_name mail.smarttukang.com;
    add_header "Cache-Control" "no-store, no-cache, must-revalidate, post-check=0, pre-check=0";
    add_header "Pragma" "no-cache";
    add_header "X-XSS-Protection" "1; mode=block";
    add_header "X-Content-Type-Options" "nosniff";
    add_header "X-Download-Options" "noopen";
    add_header "X-Permitted-Cross-Domain-Policies" "master-only";
    location / {
        # limit zone request with a burst of 50
        limit_req zone=dev burst=50 nodelay;
        try_files $uri $uri/ /index.php?$query_string;
    }
    include php.conf;
    include cache.conf;
    location ^~ /data {
        deny all;
    }
}
