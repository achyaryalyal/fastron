## Blokir request aneh dan mencurigakan
set $blokir_request 0;

## By karakter yang ada di URL
if ($request_uri ~* "ALFA_DATA|alfacgi|alfa-rex|alfanew|www\.slims\.web\.id|\.env|info\.php|<script>|%3Cscript%3E|%3C/script%3E|onerror=|onload=|%3Cimg|javascript:|<iframe|%3Ciframe|document\.cookie|alert\(document\.domain\)|%22%3E%3Cscript%3E|\.\./|%2e%2e|%252e|%5c|%2f%2e%2e|\.\.%2f|\.\.%5c|/etc/passwd|togel|\?ios|\?bet|\?down/") { set $blokir_request 1; }

## By method selain GET dan POST
if ($request_method !~ ^(GET|POST)$) { set $blokir_request 1; }

## By user agent
if ($http_user_agent ~* "python-requests|Python-urllib|Mozlila|Mozila|Go-http-client|SemrushBot|wp_is_mobile|zgrab|ClaudeBot") { set $blokir_request 1; }

## Allow & ignore all .well-known request from logging
location ~ /.well-known {
  auth_basic off;
  allow all;
  access_log off;
  log_not_found off;
}

## Disable all access to the following directories
location ~ /(app|assets|ide|sites|wordpress)$ { set $blokir_request 1; }
## Block any exploits that does not want any email notice
location ~* /(downloader|phpmyadmin|phpMyAdmin|pma|pmd|apple-app-site-association|bea_wls_deployment_internal|HNAP1|console|recordings|alfacgiapi|ALFA_DATA|indoxploit)$ { set $blokir_request 1; }
## Block common exploits
location ~* /(assets|files|uploads|tmp|resources|static|wp-includes|wp-content)/.*\.phtml$ { set $blokir_request 1; }
location ~* /(assets|files|uploads|tmp|resources|static|wp-includes|wp-content)/.*\.php$ { set $blokir_request 1; }
location ~* /(assets|files|uploads|tmp|resources|static|wp-includes|wp-content)/.*\.asp$ { set $blokir_request 1; }
location ~* /(assets|files|uploads|tmp|resources|static|wp-includes|wp-content)/.*\.rb$ { set $blokir_request 1; }
location ~* /(assets|files|uploads|tmp|resources|static|wp-includes|wp-content)/.*\.py$ { set $blokir_request 1; }
location ~* \.(pl|cgi|py|sh|lua|exe|ini|pot|htc|esp|asp|action|alfa)$ { set $blokir_request 1; }
if ($request_method !~ ^(GET|HEAD|POST)$ ) { set $blokir_request 1; }
if ($args ~* "mosConfig_[a-zA-Z_]{1,21}(=|%3D)") { set $blokir_request 1; }
## Block SQL injections
if ($args ~* "(%3D0x|%280x|%200x|%270x|\/\*|\*\/|\||&&|--|\'|#|@@)") { set $blokir_request 1; }
if ($args ~* "(select%20|union%20|all%20|case%20|when%20|then%20|else%20|from%20|insert%20|update%20|delete%20|drop%20|and%20|or%20|group%20|table%20|declare%20|--%20|concat%28|md5%28|ascii%28|chr%28|hex%28|unhex%28|sleep%28|%20end|%20numeric|%20null)") { set $blokir_request 1; }
## Block obvious RFI
#if ($args ~* "(http:|https:|ftp:|php:|sftp:|zlib:|data:|glob:|phar:|file:|gopher:)") { return 403; }
if ($args ~* "(http:|https:|ftp:|php:|sftp:|zlib:|data:|glob:|phar:|gopher:)") { set $blokir_request 1; }
## Block directory traversal
if ($args ~* "etc/passwd") { set $blokir_request 1; } # obvious probe
if ($args ~* "c:") { set $blokir_request 1; } # obvious windows path
if ($args ~* "cmd.exe") { set $blokir_request 1; } # obvious probe
## HTTP Response Splitting / HTTP Header Injection
if ($request_uri ~* "%0D|%0A") { set $blokir_request 1; }
if ($request_uri ~* "headername:%20") { set $blokir_request 1; }
## Cross Site Scripting
#if ($args ~* "(<|%3C|>|%3E|[|]|~|`)") { return 403; }
if ($args ~* "(<script|<svg|<img|%3C|<|>|%3E|[|]|~|`)") { set $blokir_request 1; }
## Evading tricks
if ($args ~* "(&#|%U)") { set $blokir_request 1; }
# common nginx configuration to block sql injection and other attacks
location ~* "(eval\()"  { set $blokir_request 1; }
location ~* "(127\.0\.0\.1)"  { set $blokir_request 1; }
location ~* "([a-z0-9]{2000})"  { set $blokir_request 1; }
location ~* "(javascript\:)(.*)(\;)"  { set $blokir_request 1; }
location ~* "(base64_encode)(.*)(\()"  { set $blokir_request 1; }
location ~* "(GLOBALS|REQUEST)(=|\[|%)"  { set $blokir_request 1; }
location ~* "(<|%3C).*script.*(>|%3)" { set $blokir_request 1; }
location ~ "(\\|\.\.\.|\.\./|~|`|<|>|\|)" { set $blokir_request 1; }
location ~* "(boot\.ini|etc/passwd|self/environ)" { set $blokir_request 1; }
location ~* "(thumbs?(_editor|open)?|tim(thumb)?)\.php" { set $blokir_request 1; }
location ~* "(\'|\")(.*)(base64|encode|decode|environ|globals|ini_set|localhost|loopback|magic_quotes|root|sessionid|soap|webdav|bash|git|hg|ht|svn|swp|cvs)" { set $blokir_request 1; }
location ~* "(\'|\")(.*)(request|drop|insert|md5|select|update|delete|union|concat|table|from|ascii|hex|unhex|declare)" { set $blokir_request 1; }
location ~* "(https?|ftp|php):/" { set $blokir_request 1; }
location ~* "(=\\\'|=\\%27|/\\\'/?)\." { set $blokir_request 1; }
location ~* "/(\$(\&)?|\"|\.|,|&|&amp;?)/?$" { set $blokir_request 1; }
location ~ "(\{0\}|\(/\(|\.\.\.|\+\+\+|\\\"\\\")" { set $blokir_request 1; }
location ~ "(~|`|<|>|:|;|%|\\|\s|\{|\}|\[|\]|\|)" { set $blokir_request 1; }
location ~* "/(=|\$&|_mm|(wp-)?config\.|cgi-|etc/passwd|muieblack)" { set $blokir_request 1; }
location ~* "(&pws=0|_vti_|\(null\)|\{\$itemURL\}|echo(.*)kae|etc/passwd|eval\(|self/environ)" { set $blokir_request 1; }
location ~* "\.(aspx?|bash|bak?|cfg|cgi|dll|exe|git|hg|ini|jsp|log|mdb|out|sql|svn|swp|tar|rdf)$" { set $blokir_request 1; }
location ~* "/(^$|mobiquo|phpinfo|shell|sqlpatch|thumb|thumb_editor|thumbopen|timthumb|webshell)\.php" { set $blokir_request 1; }

if ($blokir_request = 1) {
  return 403;
}
