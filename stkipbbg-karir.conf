# the zone that limit max 5 requests/sec from 1 single IP address and hold up to 10 MB of data
limit_req_zone $binary_remote_addr zone=stkipbbgkarir:10m rate=5r/s;

server {
    # server with [karir].
    listen 80;
    root /usr/share/fastron/master;
    index index.php;
    charset utf-8;
    server_name karir.stkipgetsempena.ac.id;
    add_header "Cache-Control" "no-store, no-cache, must-revalidate, post-check=0, pre-check=0";
    add_header "Pragma" "no-cache";
    add_header "X-XSS-Protection" "1; mode=block";
    add_header "X-Content-Type-Options" "nosniff";
    add_header "X-Download-Options" "noopen";
    add_header "X-Permitted-Cross-Domain-Policies" "master-only";
    location / {
        # limit zone request with a burst of 50
        limit_req zone=stkipbbgkarir burst=50 nodelay;
        try_files $uri $uri/ /index.php?$args;
        include security.conf;
        rewrite ^/(.*)/$ /$1 permanent;
        include /usr/share/fastron/master/sites/stkip-bbg/karir/router.php;
    }
    include php.conf;
    include cache.conf;
}
