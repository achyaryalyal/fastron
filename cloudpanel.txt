==================
Install CloudPanel
==================
# You need an empty server with Ubuntu 22.04 or Debian 11 with root access
# Before running the installer, we need to update the system and install the required packages
apt update && apt -y upgrade && apt -y install curl wget sudo && apt -y autoremove && reboot

# Run the installer with your preferred Database Engine
curl -sS https://installer.cloudpanel.io/ce/v2/install.sh -o install.sh; \
echo "d67e37c0fb0f3dd7f642f2c21e621e1532cadefb428bb0e3af56467d9690b713  install.sh" | \
sha256sum -c && sudo DB_ENGINE=MARIADB_10.9 bash install.sh

# You can now access CloudPanel via Browser: https://yourIpAddress:8443
# Ignore the self-signed certificate warning and click on Advanced and Proceed to continue to CloudPanel

# To update CloudPanel to the latest version, run the update script:
clp-update

# CloudPanel creates a dump of each backup database every midnight. To disable autobackup task, just comment out the line
nano /etc/cron.d/clp
#15 3 * * * clp /usr/bin/bash -c "/usr/bin/clpctl db:backup --ignoreDatabases='db1,db2' --retentionPeriod=7" &> /dev/null
#15 4 * * * clp /home/clp/scripts/create_backup.sh &> /dev/null

# troubleshoot: "W: GPG error: https://dl.yarnpkg.com/debian stable InRelease: The following signatures were invalid"
sudo apt-key adv --refresh-keys --keyserver keyserver.ubuntu.com
sudo apt update

===============
Edit SSH Config
===============
nano /etc/ssh/sshd_config
# set:
	ClientAliveInterval 120
	ClientAliveCountMax 720
service ssh restart

===============================
Install WordPress at CloudPanel
===============================
# Click on + Add Site and then click on Create a WordPress Site
# Enter the Domain Name, Site Title, Admin User Name, Admin Password, and Admin E-Mail and click on Create
# Done. The WordPress Site has been created
# In "PHP Settings", make sure version=PHP 8.2, make sure max_input_vars=10000, make sure date.timezone=Asia/Jakarta;

============================
Install Moodle at CloudPanel
============================
# Click on + Add Site and then click on Create a PHP Site
# Select the Application Moodle 4, enter Domain Name, Site User, Site User Password, and click on Create
# Creating a Moodle Project (v4.1.0 support PHP 8)
cd /opt && curl -sL https://github.com/moodle/moodle/archive/refs/tags/v4.1.0.tar.gz | tar xfz -
cp -R /opt/moodle-4.1.0/* /home/[USER_NAME]/htdocs/[SITE_DOMAIN]/
rm -rf /opt/moodle-*
# install unoconv for moodle document converter, you can enable the plugin and fill the path: /usr/bin/unoconv
sudo apt update && sudo apt install unoconv
# In "PHP Settings"
	make sure version=PHP 8.1; // because 8.2 still deprecated: Creation of dynamic property cache_config::$configlockmappings
	make sure max_input_vars=10000;
	make sure date.timezone=Asia/Jakarta;
# In "Vhost", don't put rate limit because it's culprit for some services like /lib/ajax/service.php?sesskey=.... which makes dashboard dialog box error undefined 503
# In "Databases", create a database
# In "SSL/TLS", create and install Let's Encrypt Certificate
# In "Cron Jobs", add cron job every minute: /usr/bin/php8.1 /[YOUR_MOODLE_PATH]/admin/cli/cron.php
# In "Cron Jobs", add cron job every hourly: /usr/bin/php8.1 /[YOUR_MOODLE_PATH]/admin/cli/scheduled_task.php --execute="\core\task\file_trash_cleanup_task"
# In "Cron Jobs", add cron job every monthly: /usr/bin/php8.1 /[YOUR_MOODLE_PATH]/admin/cli/kill_all_sessions.php
	curl -sSL https://raw.githubusercontent.com/achyaryalyal/fastron/master/moodle/script-moodle-list-old-files.php > /[YOUR_MOODLE_PATH]/admin/script-moodle-list-old-files.php
	curl -sSL https://raw.githubusercontent.com/achyaryalyal/fastron/master/moodle/script-moodle-delete-old-files.sh > /[YOUR_MOODLE_PATH]/admin/script-moodle-delete-old-files.sh
	chmod +x /[YOUR_MOODLE_PATH]/admin/script-moodle-delete-old-files.sh
	chmod 0755 /[YOUR_MOODLE_PATH]/admin/script-moodle-delete-old-files.sh
# In "Cron Jobs", add cron job every week: sh /[YOUR_MOODLE_PATH]/admin/script-moodle-delete-old-files.sh
# Open your site in the browser, and go through the Moodle Installer. Choose MariaDB as database engine. Make sure Your server environment meets all minimum requirements
# Disable "Automated backup setup" in Administration -> Courses -> Backups -> Automated backup setup
# Disable "Recycle bin" in Administration -> Plugins -> Admin tools -> Recycle bin
# Make sure onluy Standard log is Enable in Administration -> Plugins -> Logging -> Manage log stores
# Make sure this file exist on wwwroot: favicon.ico, apple-touch-icon-120x120-precomposed.png, apple-touch-icon-120x120.png, apple-touch-icon-precomposed.png, apple-touch-icon.png
# You can check used moodledata directory size with this script and access https://[DOMAIN.COM]/admin/script-moodle-directory-size.php
	curl -sSL https://raw.githubusercontent.com/achyaryalyal/fastron/master/moodle/script-moodle-directory-size.php > /[YOUR_MOODLE_PATH]/admin/script-moodle-directory-size.php
# nano /[YOUR_MOODLE_PATH]/course/edit_form.php
# $mform->addElement('text', 'shortname', get_string('shortnamecourse'), 'maxlength="100" size="20"');
# change to:
# $mform->addElement('text', 'shortname', 'Course code dari OPEN SIMKA', 'maxlength="100" minlength="16" size="20"');

============================
Install Slims at CloudPanel
============================
# Click on + Add Site and then click on Create a PHP Site
# Select the Application Slims 4, enter Domain Name, Site User, Site User Password, and click on Create
# Creating a Slims Project (v9.5.2 support PHP 8)
# make sure, you have installed YAZ [optional]
apt install php-dev php-pear yaz libyaz5 libyaz-dev libnet-z3950-zoom-perl
pecl channel-update pecl.php.net
pecl install yaz
# In "PHP Settings"
	make sure version=PHP 8.1; // because 8.2 still deprecated: Creation of dynamic property cache_config::$configlockmappings
	make sure max_input_vars=10000;
	make sure date.timezone=Asia/Jakarta;
	make sure extension=yaz.so;
# In "Vhost", don't put rate limit because it's culprit for some services like /lib/ajax/service.php?sesskey=.... which makes dashboard dialog box error undefined 503
# In "Databases", create a database
# In "SSL/TLS", create and install Let's Encrypt Certificate
# to customize theme: Login Admin > Tema > Default > Customize
# to activate visitor link, just leave empty in: Login Admin > Sistem > Pengaturan Sistem > IP Yang Diizinkan
# to show visitor link, edit file /template/default/parts/_navbar.php line 26, add this array:
  'visitor' => [
    'text' => __('Pengunjung'),
    'url' => 'index.php?p=visitor'
  ],
# to edit quote in visitor page, edit file /template/default/visitor_template.php, edit some array value in "this.quotes" line 134
# to edit text button in visitor page, edit same file, change "Masuk" to "Check In"

============================
Plus Minus CloudPanel
============================
Intinya CloudPanel cocok untuk control panel turunan (bukan control panel induk) karena di CloudPanel tidak ada fitur manajemen DNS
- edit DNS record -> TIDAK BISA
- tes kirim email dengan script php murni -> TIDAK BISA karena tidak ada mail server, sebab control panel ini memang fokusnya mengutamakan performa web server dan database server agar lebih ringan dan lincah tanpa dibebani oleh mail server
- htaccess -> TIDAK BISA, harus convert dulu ke nginx rule melalui situs https://winginx.com/en/htaccess kemudian simpan rule tersebut di bagian Vhost tepat di bawah {{settings}}
- ganti versi php -> BISA
- edit php.ini -> BISA
- tambah domain / subdomain -> BISA, tinggal pilih isinya berupa wordpress / any php site / any node.js site / just static html site / any python site
- sertifikat ssl -> BISA, tinggal create and install sertifikat letsencrypt di bagian "SSL/TLS"
- akses phpmyadmin -> BISA
- tambah module / ekstensi php -> SUDAH LENGKAP, gak ada yang perlu ditambah
- install wordpress -> BISA dan support multisite
- install moodle -> BISA
- install ojs dan slims -> kemungkinan besar TIDAK BISA karena harus try and error sendiri dalam membuat manual script Vhost
