===================================
Install EPrints on Ubuntu 22.04 LTS
===================================
sudo apt-get update -y && apt-get upgrade -y && apt-get autoremove -y --purge && apt-get autoclean -y
sudo apt-get install -y nano ntp neofetch curl wget git zip unzip rar unrar
hostnamectl set-hostname [YOUR_HOSTNAME] && hostname
nano /etc/ssh/sshd_config
# set:
	LoginGraceTime 120
	ClientAliveInterval 120
	ClientAliveCountMax 720
service ssh restart
systemctl enable ntp && dpkg-reconfigure tzdata && date
swapon --show
fallocate -l 4G /swapfile && chmod 600 /swapfile
mkswap /swapfile && swapon /swapfile && swapon --show
nano /etc/fstab
# paste it at last line:
/swapfile swap swap defaults 0 0
# check again
swapon --show

nano /etc/apt/sources.list.d/eprints.list
deb http://deb.eprints-hosting.org/3.4/stable/ ./
wget -O /etc/apt/trusted.gpg.d/eprints.gpg http://deb.eprints.org/keyFile.gpg && apt-get update
##### or
##### wget -O - http://deb.eprints-hosting.org/keyFile | apt-key add - && apt update && apt upgrade -y

# install xpdf
apt install libpoppler-dev xpdf
##### or
##### wget http://security.ubuntu.com/ubuntu/pool/main/p/poppler/libpoppler73_0.62.0-2ubuntu2.12_amd64.deb
##### wget http://archive.ubuntu.com/ubuntu/pool/universe/x/xpdf/xpdf_3.04-7_amd64.deb
##### dpkg -i libpoppler73_0.62.0-2ubuntu2.12_amd64.deb && apt install --fix-broken -y
##### dpkg -i xpdf_3.04-7_amd64.deb && apt install --fix-broken -y

# install eprints
apt install eprints -y
# it will be installed to: /usr/share/eprints/

# download publications flavoured repository
wget https://files.eprints.org/2715/2/eprints-3.4.4-flavours.tar.gz
tar -xzvf eprints-3.4.4-flavours.tar.gz -C /usr/share/eprints/
mv /usr/share/eprints/eprints-3.4.4/flavours /usr/share/eprints/
rmdir /usr/share/eprints/eprints-3.4.4/
rm eprints-3.4.4-flavours.tar.gz
##### or
##### wget https://files.eprints.org/2715/2/eprints-3.4.4-flavours.tar.gz
##### tar -xzvf eprints-3.4.4-flavours.tar.gz
##### mv eprints-3.4.4/flavours/pub_lib /usr/share/eprints/flavours
##### chmod -R g+w /usr/share/eprints/flavours/pub_lib
##### chown -R eprints:eprints /usr/share/eprints/flavours/pub_lib

# set password for mysql
mysql -u root
USE mysql;
ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'rahasia';
FLUSH PRIVILEGES;
exit

su -l eprints
./bin/epadmin create pub
# Archive ID? eprints
# Configure vital settings? [yes] ? ENTER
# Hostname? [YOUR_SUBDOMAIN]
# Webserver Port [80] ? ENTER
# Alias (enter # when done) [#] ? ENTER
# Path [/] ? ENTER
# HTTPS Hostname [] ? [YOUR_SUBDOMAIN]
Secure Webserver Port [443] ? [ENTER]
# Administrator Email? [YOUR_SYSTEM_EMAIL_OR_ADMIN_EMAIL]
# Archive Name [Test Repository] ? [YOUR_REPOSITORY_NAME]
# Organisation Name [Organisation of Test] ? [YOUR_ORG_NAME]
# Write these core settings? [yes] ? ENTER
# Configure database? [yes] ? ENTER
# Database Name [eprints] ? ENTER
# MySQL Host [localhost] ? ENTER
# MySQL Port (# for no setting) [#] ? ENTER
# MySQL Socket (# for no setting) [#] ? ENTER
# Database User [eprints] ? ENTER
# Database Password [h6oJF41f] ENTER
# Database Engine [InnoDB] ? ENTER
# Write these database settings? [yes] ? ENTER
# Create database "eprints" [yes] ? ENTER
# Database Superuser Username [root] ? ENTER
# Database Superuser Password? rahasia
# Create database tables? [yes] ? ENTER
# Create an initial user? [yes] ? ENTER
# Enter a username [admin] ? ENTER
# Select a user type (user|editor|admin) [admin] ? ENTER
# Do you want to build the static web pages? [yes] ? ENTER
# Do you want to import the LOC subjects and sample divisions? [yes] ? ENTER
# Do you want to update the apache config files? (you still need to add the 'Include' line) [yes] ? ENTER
exit
# make sure that your main apache config file contains the line:
	Include /usr/share/eprints/cfg/apache.conf
# then stop and start your webserver
# then try connecting to your repository
# don't forget to register your repository at http://roar.eprints.org/

nano /etc/apache2/sites-available/000-default.conf
# tambahkan ServerName di dalam konfigurasi VirtualHost
	ServerName IP_SERVER
a2ensite eprints
a2enmod ssl
systemctl restart apache2
systemctl status apache2
# go to your subdomain with https://________

# Make sure you remove or disable your archive's cfg/cfg.d/https.pl if it exists as it may override the configuration below. Once you have updated your configuration you must run generate_apacheconf to regenerate configuration for Apache before restarting the web server.
# config HTTP Only
$c->{host} = 'example.eprints.org';
$c->{port} = 80;
$c->{securehost} = undef;
$c->{secureport} = undef;
# config HTTPS When You Login
$c->{host} = 'example.eprints.org';
$c->{port} = 80;
$c->{securehost} = $c->{host};
$c->{secureport} = 443;
# config HTTPS Only
$c->{host} = undef;
$c->{port} = 80;
$c->{securehost} = 'example.eprints.org';
$c->{secureport} = 443;

# Troubleshoot: MySQL root user cannot be used
CREATE USER 'eprints'@'localhost' IDENTIFIED by 'changeme';
GRANT ALL PRIVILEGES ON *.* TO 'eprints'@'localhost' WITH GRANT OPTION;
